<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Social Media Analytics and Research - Week 5 Lab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./week3.html">Tutorials</a></li><li class="breadcrumb-item"><a href="./week5.html">Week 5 Lab</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Social Media Analytics and Research</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 3 Lab</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 4 Lab</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week5.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Week 5 Lab</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#youtube-data-api-v3" id="toc-youtube-data-api-v3" class="nav-link active" data-scroll-target="#youtube-data-api-v3">YouTube Data API V3</a>
  <ul class="collapse">
  <li><a href="#get-your-youtube-client-id-and-sercret" id="toc-get-your-youtube-client-id-and-sercret" class="nav-link" data-scroll-target="#get-your-youtube-client-id-and-sercret">Get your YouTube Client ID and Sercret</a></li>
  <li><a href="#download-youtube-data-through-tuber-package." id="toc-download-youtube-data-through-tuber-package." class="nav-link" data-scroll-target="#download-youtube-data-through-tuber-package.">Download YouTube data through <code>tuber</code> package.</a>
  <ul class="collapse">
  <li><a href="#loading-package" id="toc-loading-package" class="nav-link" data-scroll-target="#loading-package">Loading package</a></li>
  <li><a href="#authorizing-with-the-client-id-and-secret" id="toc-authorizing-with-the-client-id-and-secret" class="nav-link" data-scroll-target="#authorizing-with-the-client-id-and-secret">Authorizing with the client ID and secret</a></li>
  <li><a href="#collecting-comments-from-a-youtube-video" id="toc-collecting-comments-from-a-youtube-video" class="nav-link" data-scroll-target="#collecting-comments-from-a-youtube-video">Collecting comments from a YouTube video</a></li>
  <li><a href="#collecting-comments-from-a-channel" id="toc-collecting-comments-from-a-channel" class="nav-link" data-scroll-target="#collecting-comments-from-a-channel">Collecting comments from a channel</a></li>
  <li><a href="#collecting-comments-from-a-list" id="toc-collecting-comments-from-a-list" class="nav-link" data-scroll-target="#collecting-comments-from-a-list">Collecting comments from a list</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 5 Lab</h1>
<p class="subtitle lead">Data collection: an example using YouTube API</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="youtube-data-api-v3" class="level1">
<h1>YouTube Data API V3</h1>
<section id="get-your-youtube-client-id-and-sercret" class="level2">
<h2 class="anchored" data-anchor-id="get-your-youtube-client-id-and-sercret">Get your YouTube Client ID and Sercret</h2>
<ol type="1">
<li><p>You will need to have a Google account/gmail (e.g., RIT email).</p></li>
<li><p>Log in Google’s developers console to create a new project: https://console.developers.google.com/</p></li>
</ol>
<p><img src="image/youtube/01.png" class="img-fluid" style="width:50.0%"></p>
<ol start="3" type="1">
<li>Click “Enabled APIs &amp; services”, search for “YouTube Data API V3” and enable it.</li>
</ol>
<p><img src="image/youtube/02.png" class="img-fluid" style="width:50.0%"> <img src="image/youtube/02-1.png" class="img-fluid" style="width:50.0%"> <img src="image/youtube/02-2.png" class="img-fluid" style="width:50.0%"></p>
<ol start="4" type="1">
<li><p>Create your API key, choose “Public data”, then restrict the API with only the YouTube Data API V3. <img src="image/youtube/03.png" class="img-fluid" style="width:50.0%"> <img src="image/youtube/03-1.png" class="img-fluid" style="width:50.0%"> <img src="image/youtube/03-2.png" class="img-fluid" style="width:50.0%"></p></li>
<li><p>Create the credentials for your API keys. Configure your OAuth consent screen, choose <em>internal</em> user type (if you choose external user, extra steps for authorization might be needed), put in your email contact,then you should be able to see the client ID and secret. Copy and save it, and don’t share with others.</p></li>
</ol>
<p><img src="image/youtube/04.png" class="img-fluid" style="width:50.0%"> <img src="image/youtube/04-1.png" class="img-fluid" style="width:50.0%"> <img src="image/youtube/04-2.png" class="img-fluid" style="width:50.0%"> <img src="image/youtube/04-3.png" class="img-fluid" style="width:50.0%"></p>
<p>Lastly you might need to add a redirect url into your client ID. Under <em>Cresidentials</em>, click on the Client ID you created, then put “http://localhost:1410/” into “Authorized redirect URIs”, and save it.</p>
<p>Additionally, if you are making it for external usage, you might need to do an extra step for verification. Under the tab of “OAuth consent screen”, click “Publish APP”.</p>
</section>
<section id="download-youtube-data-through-tuber-package." class="level2">
<h2 class="anchored" data-anchor-id="download-youtube-data-through-tuber-package.">Download YouTube data through <code>tuber</code> package.</h2>
<section id="loading-package" class="level3">
<h3 class="anchored" data-anchor-id="loading-package">Loading package</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("tuber")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tuber)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="authorizing-with-the-client-id-and-secret" class="level3">
<h3 class="anchored" data-anchor-id="authorizing-with-the-client-id-and-secret">Authorizing with the client ID and secret</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>client_id <span class="ot">&lt;-</span> <span class="st">"514872803270-ghqbfmufrm4j8h3ttaafeaur3q06dnva.apps.googleusercontent.com"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>client_secret <span class="ot">&lt;-</span> <span class="st">"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"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">yt_oauth</span>(<span class="at">app_id =</span> client_id,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">app_secret =</span> client_secret,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">token =</span> <span class="st">" "</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">yt_authorized</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you sign in with your gmail account, click <em>allow</em> the authorization, then you should be able to see the following page, which mean you have successfully complete the authorization process and you can now close the page. <img src="image/youtube/final.png" class="img-fluid"></p>
</section>
<section id="collecting-comments-from-a-youtube-video" class="level3">
<h3 class="anchored" data-anchor-id="collecting-comments-from-a-youtube-video">Collecting comments from a YouTube video</h3>
<p>Before collecting the comments, you will need the ID of the video. The ID can be identifid from the url. For instance, we are using a video titled “Exposing the Russian Military Unit Behind a Massacre in Bucha | Visual Investigations” from the New York Times channel as an example. You can find the ID for this specific video is <code>IrGZ66uKcl0</code> (after <code>v=</code>) in the URL. <img src="image/youtube/videoid.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>comment <span class="ot">&lt;-</span> <span class="fu">get_all_comments</span>(<span class="at">video_id =</span> <span class="st">"IrGZ66uKcl0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>You might run into a error message - “HTTP failure: 401” once in a while, which is highly likely due to the short expiration time for the access token. It seems that there are no systematic ways to fix it for now. But you can remove the <code>.httr-oauth</code> file in your working directory and re-authorize it manually again (so I would suggest you to set up the working directory before you start any project)</p>
</div>
</div>
<p>You can take a quick glimpse at the comments you collected. You probabbly notice that the numbers of observations are different than what you saw on the webpage. Some of them could be filtered by anti-spam bots or some other reasons related to the API. Most of the variables are pretty much self-explanatory based on their names. To be noted, <code>parentId</code> specifies the ID of the comment for which replies should be retrieved. In other words, if it shows <code>NA</code>, it is <strong>not</strong> a reply. Currently, YouTube only supports replies only for top-level comments. For more details, please refer to <a href="https://developers.google.com/youtube/v3/docs">YouTube data API document</a>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Typically, every API will have rate limits, which can restrict the number of times a user or client can access the server within a specified period of time. By default, YouTube data API v3 token grant rate limit is 10,000 grants per day (not necessary equal to the number of comments). You can either apply to raise the daily token limits; or switch to another API when it reaches the rate limits. <img src="image/youtube/ratelimit.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(comment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Additionally, you can also get the statistics of the whole videos including the count of view, like, favorite, and comment. To be noted, it will be stored in a <code>list</code> rather than a <code>dataframe</code>. But we can transform it into a <code>dataframe</code> which might be easier to merge or analyze later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>stat <span class="ot">&lt;-</span> <span class="fu">get_stats</span>(<span class="at">video_id =</span> <span class="st">"IrGZ66uKcl0"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>stat_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(stat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="collecting-comments-from-a-channel" class="level3">
<h3 class="anchored" data-anchor-id="collecting-comments-from-a-channel">Collecting comments from a channel</h3>
<p>First you need to identify the channel ID. You can go to the <code>about</code> page, click the share icon and <code>copy channel ID</code>. For instance, the channel ID for <a href="https://www.youtube.com/@nytimes">NYT’s channel</a> is <code>UCvsAa96EzubF7zNHJEzvG2g</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>nytstat <span class="ot">&lt;-</span> <span class="fu">get_channel_stats</span>(<span class="st">"UCqnbDFdCpuN8CMEg0VuEBqA"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>nytvideos <span class="ot">=</span> <span class="fu">yt_search</span>(<span class="at">term=</span><span class="st">""</span>, <span class="at">type=</span><span class="st">"video"</span>, <span class="at">channel_id =</span> <span class="st">"UCqnbDFdCpuN8CMEg0VuEBqA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the previous chunk, we would like to collect each video ID in the channel. Then we will extract the IDs and iterate the same function <code>get_comment_threads</code> for each ID.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>nytcomments <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">as.character</span>(nytvideos<span class="sc">$</span>video_id), <span class="cf">function</span>(x){<span class="fu">get_comment_threads</span>(<span class="fu">c</span>(<span class="at">video_id =</span> x), <span class="at">max_results =</span> <span class="dv">20</span>)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>nytcomments_df <span class="ot">&lt;-</span> nytcomments <span class="sc">%&gt;%</span> <span class="fu">map_df</span>(as_tibble)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>nytcomments_df<span class="sc">$</span>videoId <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(nytcomments_df<span class="sc">$</span>videoId)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(nytcomments_df<span class="sc">$</span>videoId )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly, you can also get the stats from every video.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>nyt_videostat <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">as.character</span>(nytvideos<span class="sc">$</span>video_id), <span class="cf">function</span>(x){<span class="fu">get_stats</span>(<span class="fu">c</span>(<span class="at">video_id =</span> x))})</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>nyt_videostat_df <span class="ot">&lt;-</span> nyt_videostat <span class="sc">%&gt;%</span> <span class="fu">map_df</span>(as_tibble)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>nyt_videostat_df <span class="ot">&lt;-</span> nyt_videostat_df <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(id, <span class="at">keep_all =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And you can merge the video stat with the comments (for later analysis if needed)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>nyt_all <span class="ot">&lt;-</span> <span class="fu">merge</span>(nytcomments_df, nyt_videostat_df, <span class="at">by.x =</span> <span class="st">"videoId"</span>, <span class="at">by.y =</span> <span class="st">"id"</span>, <span class="at">all.x =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="collecting-comments-from-a-list" class="level3">
<h3 class="anchored" data-anchor-id="collecting-comments-from-a-list">Collecting comments from a list</h3>
<p>Sometime, you might not need all the videos in a channel. Then you can collect the videos for a specific list. For instance, we are using <a href="https://www.youtube.com/playlist?list=PL4CGYNsoW2iC67ssBNT-h7nTLbckKZByR"><code>Russia-Ukraine War</code> playlist</a> under the New York Times YouTube channel as an example. And you can also identify the playlist ID in the URL, and the playlist ID here is <code>PL4CGYNsoW2iC67ssBNT-h7nTLbckKZByR</code>.</p>
<p><img src="image/youtube/list.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ukraine_list <span class="ot">&lt;-</span> <span class="fu">get_playlist_items</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">c</span>(<span class="at">playlist_id =</span> <span class="st">"PL4CGYNsoW2iC67ssBNT-h7nTLbckKZByR"</span>),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">max_results =</span> <span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ukraine_comments <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">as.character</span>(ukraine_list<span class="sc">$</span>contentDetails.videoId), <span class="cf">function</span>(x){ <span class="fu">get_comment_threads</span>(<span class="fu">c</span>(<span class="at">video_id =</span> x), <span class="at">max_results =</span> <span class="dv">100</span>)})</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>ukraine_comments_df <span class="ot">&lt;-</span> ukraine_comments <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">map_df</span>(as_tibble)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ukraine_videostat <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">as.character</span>(ukraine_stat<span class="sc">$</span>contentDetails.videoId), <span class="cf">function</span>(x){<span class="fu">get_stats</span>(<span class="fu">c</span>(<span class="at">video_id =</span> x))})</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>ukraine_videostat_df <span class="ot">&lt;-</span> ukraine_videostat <span class="sc">%&gt;%</span> <span class="fu">map_df</span>(as_tibble)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>