<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ryan Y. Wang, Ph.D.">
<meta name="dcterms.date" content="2023-09-18">

<title>Social Media Analytics and Research - COMM 605</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      Social Media Analytics and Research
      </li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Social Media Analytics and Research</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 3 Lab</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 4 Lab</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 5 Lab</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 6 Lab</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 8 Lab</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#defining-social-data" id="toc-defining-social-data" class="nav-link active" data-scroll-target="#defining-social-data">Defining social data</a></li>
  <li><a href="#the-case-of-google-flu-trends" id="toc-the-case-of-google-flu-trends" class="nav-link" data-scroll-target="#the-case-of-google-flu-trends">The case of Google Flu Trends</a></li>
  <li><a href="#validity-of-social-data-research" id="toc-validity-of-social-data-research" class="nav-link" data-scroll-target="#validity-of-social-data-research">Validity of social data research</a></li>
  <li><a href="#potential-biases" id="toc-potential-biases" class="nav-link" data-scroll-target="#potential-biases">Potential biases</a></li>
  <li><a href="#other-biases" id="toc-other-biases" class="nav-link" data-scroll-target="#other-biases">Other biases</a></li>
  <li><a href="#three-ethical-challenges-examples" id="toc-three-ethical-challenges-examples" class="nav-link" data-scroll-target="#three-ethical-challenges-examples">Three ethical challenges examples</a>
  <ul class="collapse">
  <li><a href="#emotion-contagion-project" id="toc-emotion-contagion-project" class="nav-link" data-scroll-target="#emotion-contagion-project">Emotion contagion project</a></li>
  </ul></li>
  <li><a href="#three-ethical-challenges-examples-1" id="toc-three-ethical-challenges-examples-1" class="nav-link" data-scroll-target="#three-ethical-challenges-examples-1">Three ethical challenges examples</a>
  <ul class="collapse">
  <li><a href="#tastes-ties-and-time-project" id="toc-tastes-ties-and-time-project" class="nav-link" data-scroll-target="#tastes-ties-and-time-project">Tastes, Ties, and Time project</a></li>
  </ul></li>
  <li><a href="#three-ethical-challenges-examples-2" id="toc-three-ethical-challenges-examples-2" class="nav-link" data-scroll-target="#three-ethical-challenges-examples-2">Three ethical challenges examples</a>
  <ul class="collapse">
  <li><a href="#encore-project" id="toc-encore-project" class="nav-link" data-scroll-target="#encore-project">Encore project</a></li>
  </ul></li>
  <li><a href="#ethics-in-digital-research" id="toc-ethics-in-digital-research" class="nav-link" data-scroll-target="#ethics-in-digital-research">Ethics in digital research</a>
  <ul class="collapse">
  <li><a href="#four-principles-salganik-2017" id="toc-four-principles-salganik-2017" class="nav-link" data-scroll-target="#four-principles-salganik-2017">Four principles (Salganik, 2017):</a></li>
  </ul></li>
  <li><a href="#but-how" id="toc-but-how" class="nav-link" data-scroll-target="#but-how">But how?</a>
  <ul class="collapse">
  <li><a href="#practical-tips-salganik-2017" id="toc-practical-tips-salganik-2017" class="nav-link" data-scroll-target="#practical-tips-salganik-2017">Practical tips (Salganik, 2017):</a></li>
  </ul></li>
  <li><a href="#thank-you" id="toc-thank-you" class="nav-link" data-scroll-target="#thank-you">Thank you!</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="week6_slides.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">COMM 605</h1>
<p class="subtitle lead">Week 6: The pitfall and biases of social media data</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Ryan Y. Wang, Ph.D. </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            School of Communication
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 18, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="defining-social-data" class="level2">
<h2 class="anchored" data-anchor-id="defining-social-data">Defining social data</h2>
<p>Social data in the digital form: digital traces produced by or about users, with an emphrasis on content explictly when written with the intent of communicating or interacting with others.</p>
<ul>
<li>Social media and networking</li>
<li>Q&amp;A platforms</li>
<li>Collaboration</li>
</ul>
</section>
<section id="the-case-of-google-flu-trends" class="level2">
<h2 class="anchored" data-anchor-id="the-case-of-google-flu-trends">The case of Google Flu Trends</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../image/Google.jpeg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Lazer et al.&nbsp;(2014)</figcaption>
</figure>
</div>
<div class="notes">
<p>The example of Google Flu Trend which was discontinued in 2015. A team at Google and CDC using the data from search engine about influenzas, because people might search for flu remedies or flu symptom, and they used that do prediction. It was quite successful at the beginning then it turns out to be embarrassment. Google Flu Trends persistently overestimating flu prevalence for a much longer time. GFT also missed by a very large margin in the 2011–2012 flu season and has missed high for 100 out of 108 weeks starting with August 2011. And this error is not random errors. One of the potential causes are algorithmic confounding because Google began suggesting related search terms when people search for flu symptoms, which increase the so-called flu prevalence.</p>
</div>
</section>
<section id="validity-of-social-data-research" class="level2">
<h2 class="anchored" data-anchor-id="validity-of-social-data-research">Validity of social data research</h2>
<div class="incremental">
<ul class="incremental">
<li>Construct validity: “Do our measurements over our data measure what we think they measure?”
<ul class="incremental">
<li>Theoretical construct</li>
</ul></li>
<li>Internal validity: “Does our analysis correctly lead from the measurements to the conclusions of the study?”
<ul class="incremental">
<li>Analysis and assumption: data cleaning, distribution</li>
</ul></li>
<li>External validity: “To what extent can research findings be generalized to other sitations?”
<ul class="incremental">
<li>Ecological validity: to what extent a social media platform propoely refects a broader real-world phenomenon</li>
<li>Temporal validity: to what extent the construct change over time</li>
</ul></li>
</ul>
</div>
</section>
<section id="potential-biases" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="potential-biases">Potential biases</h2>
<ul>
<li>Data bias: sparsity and noise; availability and representativeness</li>
<li>Population bias: demographic attributes</li>
<li>Behavioral bias: interaction bias; content consumption bias; self-selection and response bias</li>
<li>Content production bias: the use of language(s), the contextual factors, power users, and different populations.</li>
<li>Linking bias: network attributes; behavior-base and cpnnection-based social links;</li>
<li>Temporal bias:
<ul>
<li>Populations, behaviors and systems drifting over time</li>
<li>Seasonal and periodic phenonmena</li>
<li>Sudden-onset phenomena</li>
<li>Time granularity can be too fine-grained to observe long-term phenomena: <a href="http://dx.doi.org/10.1561/100.00019045">An example of Trump and hate speech on Twitter</a></li>
<li>Time granularity can be too coarse-grained to observe short-lived phenonmena</li>
<li>Dataset decay and lose utility over time</li>
</ul></li>
<li>Redundancy: lexical and semantic redundancy</li>
</ul>
</section>
<section id="other-biases" class="level2">
<h2 class="anchored" data-anchor-id="other-biases">Other biases</h2>
<ul>
<li>Data source or origin</li>
<li>Data collection: data acquistion, querying data, and (post-)filtering</li>
<li>Data processing: data cleaning, enrichment (annotation), aggregation</li>
<li>Data analysis: qualitative, descritive, inference and/or prediction</li>
</ul>
</section>
<section id="three-ethical-challenges-examples" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="three-ethical-challenges-examples">Three ethical challenges examples</h2>
<section id="emotion-contagion-project" class="level3">
<h3 class="anchored" data-anchor-id="emotion-contagion-project">Emotion contagion project</h3>
<p>Four experimental groups:</p>
<ul>
<li>a “negativity-reduced” group, for whom posts with negative words (e.g., sad) were randomly blocked from appearing in the News Feed</li>
<li>a “positivity-reduced” group, for whom posts with positive words (e.g., happy) were randomly blocked</li>
<li>and two control groups, one for the positivity-reduced group and one for the negativity-reduced group.</li>
</ul>
<p>Results:</p>
<ul>
<li>People in the positivity-reduced group used slightly fewer positive words and slightly more negative words relative to the control group. Likewise, people in the negativity-reduced group used slightly more positive words and slightly fewer negative words. Thus, the researchers found evidence of emotional contagion</li>
</ul>
<p>Issues (PNAS and editorial expression of concern):</p>
<ul>
<li>Participants did not provide any consent beyond the standard Facebook terms of service and</li>
<li>The study had not undergone meaningful third-party ethical review</li>
</ul>
</section>
</section>
<section id="three-ethical-challenges-examples-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="three-ethical-challenges-examples-1">Three ethical challenges examples</h2>
<section id="tastes-ties-and-time-project" class="level3">
<h3 class="anchored" data-anchor-id="tastes-ties-and-time-project">Tastes, Ties, and Time project</h3>
<p>Beginning in 2006, each year, a team of professors and research assistants scraped the Facebook profiles of members of the Class of 2009 at a “diverse private college in the Northeastern U.S.” The researchers then merged these data from Facebook, which included information about friendships and cultural tastes, with data from the college, which included information about academic majors and where the students lived on campus.</p>
<p>Issue (oepn-source and privacy): Unfortunately, just days after the data were made available, other re- searchers deduced that the school in question was Harvard</p>
<div class="notes">
<p>These merged data were a valuable resource, and they were used to create new knowledge about topics such as how social networks form and how social networks and behavior co-evolve.</p>
</div>
</section>
</section>
<section id="three-ethical-challenges-examples-2" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="three-ethical-challenges-examples-2">Three ethical challenges examples</h2>
<section id="encore-project" class="level3">
<h3 class="anchored" data-anchor-id="encore-project">Encore project</h3>
<p>In March 2014, Sam Burnett and Nick Feamster launched Encore, a system to provide real-time and global measurements of Internet censorship. To do this, the researchers, who were at Georgia Tech, encouraged website owners to install this small code snippet into the source files of their web page.</p>
<p>Issue: Ben Zevenbergen concerned that people in certain countries could be exposed to risk if their computer attempted to visit certain sensitive websites, and these people did not con- sent to participate in the study.</p>
<div class="notes">
<p>If you happen to visit a web page with this code snippet in it, your web browser will try to contact a website that the researchers were monitoring for possible censorship. Before launching the project, the researchers conferred with their IRB, which declined to review the project because it was not “human subjects research” under the Common Rule.</p>
</div>
</section>
</section>
<section id="ethics-in-digital-research" class="level2">
<h2 class="anchored" data-anchor-id="ethics-in-digital-research">Ethics in digital research</h2>
<section id="four-principles-salganik-2017" class="level3">
<h3 class="anchored" data-anchor-id="four-principles-salganik-2017">Four principles (Salganik, 2017):</h3>
<ul>
<li>Respect for persons: treating people as autoonomous and honoring their wishes</li>
<li>Beneficence: understanding and improving the risk/benefit profile of your study, and then deciding if it strikes the right balance.
<ul>
<li>Do not harm and maximinze possible benefit and minimize possible harms</li>
</ul></li>
<li>Justice: ensuring the risks and benefits of reesarch are distributed fairly</li>
<li>Respect for law and public interest: including all relevant stakeholders</li>
</ul>
</section>
</section>
<section id="but-how" class="level2">
<h2 class="anchored" data-anchor-id="but-how">But how?</h2>
<section id="practical-tips-salganik-2017" class="level3">
<h3 class="anchored" data-anchor-id="practical-tips-salganik-2017">Practical tips (Salganik, 2017):</h3>
<ul>
<li>The IRB is a floor, not a ceiling</li>
<li>Put yourself in everyone else shoes</li>
<li>Think of research ethics as continuous, not discrete</li>
</ul>
</section>
</section>
<section id="thank-you" class="level1">
<h1>Thank you!</h1>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>